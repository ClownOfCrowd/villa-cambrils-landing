// Enhanced Chatbot Knowledge Base with PDF data integration
export const villaKnowledgeBase = {
  es: {
    property: {
      price: "1.499.990 ‚Ç¨",
      size: "805 m¬≤",
      bedrooms: "6 habitaciones",
      bathrooms: "7 ba√±os",
      features: [
        "Piscina privada en jard√≠n",
        "Zona de barbacoa",
        "Sauna de madera",
        "Garaje para 3-4 coches",
        "Gimnasio y sala de cine",
        "Chimenea en sala de estar",
        "Cocina independiente totalmente equipada",
        "Cuarto de plancha y lavadero",
        "Terraza con vistas despejadas"
      ],
      location: "Jardines de Vilafortuny, Cambrils",
      beach_distance: "1.300 metros de las playas",
      portaventura: "15 minutos en coche a PortAventura",
      year_built: "1993 (reformada con materiales de alta calidad)",
      energy_rating: "Mansi√≥n de alta standing",
      orientation: "Excelente comunicaci√≥n con autov√≠a y autopista",
      plot_size: "791 m¬≤ de parcela"
    },
    advantages: [
      "Ubicaci√≥n privilegiada en zona residencial tranquila",
      "Excelente conectividad con autopistas AP-7 y N-340",
      "Cerca de centros comerciales y restaurantes",
      "Zona verde con espacios naturales protegidos",
      "Transporte p√∫blico directo a Barcelona y Tarragona",
      "Comunidad segura con vigilancia 24h",
      "Proximidad a colegios internacionales",
      "Campo de golf a 10 minutos"
    ],
    technical_specs: {
      construction: "Mansi√≥n de alta standing reformada con materiales de alta calidad",
      layout: "Distribuida en tres plantas m√°s planta s√≥tano",
      basement: "Garaje para 3-4 coches, piso auxiliar (sala, cocina, dormitorio, ba√±o), almac√©n",
      ground_floor: "Amplio recibidor, sal√≥n comedor, sala de estar con chimenea, dormitorio suite, aseo, cocina independiente, cuarto de plancha",
      first_floor: "4 habitaciones: tres dormitorios dobles (dos suite), dormitorio principal con vestidor y ba√±o completo",
      second_floor: "Espacio di√°fano: gimnasio, sala de cine, despacho, ba√±o, terraza con vistas despejadas"
    },
    legal_info: {
      license: "Licencia de primera ocupaci√≥n vigente",
      taxes: "IBI: 2.400‚Ç¨/a√±o aproximadamente",
      community: "Gastos de comunidad: 150‚Ç¨/mes",
      documentation: "Toda la documentaci√≥n legal en regla"
    }
  },
  en: {
    property: {
      price: "‚Ç¨1,499,990",
      size: "805 m¬≤",
      bedrooms: "6 bedrooms",
      bathrooms: "7 bathrooms",
      features: [
        "Private pool in garden",
        "Barbecue area",
        "Wooden sauna",
        "Garage for 3-4 cars",
        "Gym and cinema room",
        "Fireplace in living room",
        "Fully equipped independent kitchen",
        "Laundry and ironing room",
        "Terrace with unobstructed views"
      ],
      location: "Jardines de Vilafortuny, Cambrils",
      beach_distance: "1,300 meters from beaches",
      portaventura: "15 minutes by car to PortAventura",
      year_built: "1993 (renovated with high quality materials)",
      energy_rating: "High standing mansion",
      orientation: "Excellent highway and motorway connections",
      plot_size: "791 m¬≤ plot"
    },
    advantages: [
      "Privileged location in quiet residential area",
      "Excellent highway connectivity AP-7 and N-340",
      "Close to shopping centers and restaurants",
      "Green areas with protected natural spaces",
      "Direct public transport to Barcelona and Tarragona",
      "Safe community with 24h security",
      "Proximity to international schools",
      "Golf course 10 minutes away"
    ],
    technical_specs: {
      construction: "High standing mansion renovated with high quality materials",
      layout: "Distributed over three floors plus basement",
      basement: "Garage for 3-4 cars, auxiliary apartment (living room, kitchen, bedroom, bathroom), storage",
      ground_floor: "Large entrance hall, living-dining room, living room with fireplace, bedroom suite, toilet, independent kitchen, laundry room",
      first_floor: "4 bedrooms: three double bedrooms (two suites), master bedroom with dressing room and full bathroom",
      second_floor: "Open space: gym, cinema room, office, bathroom, terrace with unobstructed views"
    },
    legal_info: {
      license: "Valid first occupancy license",
      taxes: "Property tax: approximately ‚Ç¨2,400/year",
      community: "Community fees: ‚Ç¨150/month",
      documentation: "All legal documentation in order"
    }
  },
  ca: {
    property: {
      price: "1.499.990 ‚Ç¨",
      size: "805 m¬≤",
      bedrooms: "6 habitacions",
      bathrooms: "7 banys",
      features: [
        "Piscina privada al jard√≠",
        "Zona de barbacoa",
        "Sauna de fusta",
        "Garatge per a 3-4 cotxes",
        "Gimn√†s i sala de cinema",
        "Xemeneia a la sala d'estar",
        "Cuina independent totalment equipada",
        "Quarto de planxa i rentador",
        "Terrassa amb vistes despejades"
      ],
      location: "Jardins de Vilafortuny, Cambrils",
      beach_distance: "1.300 metres de les platges",
      portaventura: "15 minuts amb cotxe a PortAventura",
      year_built: "1993 (reformada amb materials d'alta qualitat)",
      energy_rating: "Mansi√≥ d'alt standing",
      orientation: "Excel¬∑lent comunicaci√≥ amb autovia i autopista",
      plot_size: "791 m¬≤ de parcel¬∑la"
    },
    advantages: [
      "Ubicaci√≥ privilegiada en zona residencial tranquil¬∑la",
      "Excel¬∑lent connectivitat amb autopistes AP-7 i N-340",
      "A prop de centres comercials i restaurants",
      "Zona verda amb espais naturals protegits",
      "Transport p√∫blic directe a Barcelona i Tarragona",
      "Comunitat segura amb vigil√†ncia 24h",
      "Proximitat a col¬∑legis internacionals",
      "Camp de golf a 10 minuts"
    ],
    technical_specs: {
      construction: "Mansi√≥ d'alt standing reformada amb materials d'alta qualitat",
      layout: "Distribu√Øda en tres plantes m√©s planta soterrani",
      basement: "Garatge per a 3-4 cotxes, pis auxiliar (sala, cuina, dormitori, bany), magatzem",
      ground_floor: "Ampli rebedor, sal√≥ menjador, sala d'estar amb xemeneia, dormitori suite, lavabo, cuina independent, quarto de planxa",
      first_floor: "4 habitacions: tres dormitoris dobles (dos suite), dormitori principal amb vestidor i bany complet",
      second_floor: "Espai di√†fan: gimn√†s, sala de cinema, despatx, bany, terrassa amb vistes despejades"
    },
    legal_info: {
      license: "Llic√®ncia de primera ocupaci√≥ vigent",
      taxes: "IBI: 2.400‚Ç¨/any aproximadament",
      community: "Despeses de comunitat: 150‚Ç¨/mes",
      documentation: "Tota la documentaci√≥ legal en regla"
    }
  },
  ru: {
    property: {
      price: "1.499.990 ‚Ç¨",
      size: "805 –º¬≤",
      bedrooms: "6 —Å–ø–∞–ª–µ–Ω",
      bathrooms: "7 –≤–∞–Ω–Ω—ã—Ö –∫–æ–º–Ω–∞—Ç",
      features: [
        "–ß–∞—Å—Ç–Ω—ã–π –±–∞—Å—Å–µ–π–Ω –≤ —Å–∞–¥—É",
        "–ó–æ–Ω–∞ –±–∞—Ä–±–µ–∫—é",
        "–î–µ—Ä–µ–≤—è–Ω–Ω–∞—è —Å–∞—É–Ω–∞",
        "–ì–∞—Ä–∞–∂ –Ω–∞ 3-4 –∞–≤—Ç–æ–º–æ–±–∏–ª—è",
        "–°–ø–æ—Ä—Ç–∑–∞–ª –∏ –∫–∏–Ω–æ–∑–∞–ª",
        "–ö–∞–º–∏–Ω –≤ –≥–æ—Å—Ç–∏–Ω–æ–π",
        "–û—Ç–¥–µ–ª—å–Ω–∞—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–Ω–∞—è –∫—É—Ö–Ω—è",
        "–ì–ª–∞–¥–∏–ª—å–Ω–∞—è –∏ –ø—Ä–∞—á–µ—á–Ω–∞—è",
        "–¢–µ—Ä—Ä–∞—Å–∞ —Å –æ—Ç–∫—Ä—ã—Ç—ã–º–∏ –≤–∏–¥–∞–º–∏"
      ],
      location: "–ñ–∞—Ä–¥–∏–Ω—Å –¥–µ –í–∏–ª–∞—Ñ–æ—Ä—Ç—É–Ω–∏, –ö–∞–º–±—Ä–∏–ª—Å",
      beach_distance: "1.300 –º–µ—Ç—Ä–æ–≤ –¥–æ –ø–ª—è–∂–µ–π",
      portaventura: "15 –º–∏–Ω—É—Ç –Ω–∞ –º–∞—à–∏–Ω–µ –¥–æ –ü–æ—Ä—Ç-–ê–≤–µ–Ω—Ç—É—Ä—ã",
      year_built: "1993 (–æ—Ç—Ä–µ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏)",
      energy_rating: "–û—Å–æ–±–Ω—è–∫ –≤—ã—Å–æ–∫–æ–≥–æ –∫–ª–∞—Å—Å–∞",
      orientation: "–û—Ç–ª–∏—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∞–≤—Ç–æ–º–∞–≥–∏—Å—Ç—Ä–∞–ª—è–º–∏",
      plot_size: "–£—á–∞—Å—Ç–æ–∫ 791 –º¬≤"
    },
    advantages: [
      "–ü—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤ —Ç–∏—Ö–æ–º –∂–∏–ª–æ–º —Ä–∞–π–æ–Ω–µ",
      "–û—Ç–ª–∏—á–Ω–∞—è —Å–≤—è–∑—å —Å –∞–≤—Ç–æ–º–∞–≥–∏—Å—Ç—Ä–∞–ª—è–º–∏ AP-7 –∏ N-340",
      "–†—è–¥–æ–º —Ç–æ—Ä–≥–æ–≤—ã–µ —Ü–µ–Ω—Ç—Ä—ã –∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã",
      "–ó–µ–ª–µ–Ω–∞—è –∑–æ–Ω–∞ —Å –æ—Ö—Ä–∞–Ω—è–µ–º—ã–º–∏ –ø—Ä–∏—Ä–æ–¥–Ω—ã–º–∏ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞–º–∏",
      "–ü—Ä—è–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ë–∞—Ä—Å–µ–ª–æ–Ω–æ–π –∏ –¢–∞—Ä—Ä–∞–≥–æ–Ω–æ–π",
      "–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ —Å –æ—Ö—Ä–∞–Ω–æ–π 24—á",
      "–ë–ª–∏–∑–æ—Å—Ç—å –∫ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–º —à–∫–æ–ª–∞–º",
      "–ü–æ–ª–µ –¥–ª—è –≥–æ–ª—å—Ñ–∞ –≤ 10 –º–∏–Ω—É—Ç–∞—Ö"
    ],
    technical_specs: {
      construction: "–û—Å–æ–±–Ω—è–∫ –≤—ã—Å–æ–∫–æ–≥–æ –∫–ª–∞—Å—Å–∞, –æ—Ç—Ä–µ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã—Å–æ–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏",
      layout: "–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω –Ω–∞ —Ç—Ä–µ—Ö —ç—Ç–∞–∂–∞—Ö –ø–ª—é—Å —Ü–æ–∫–æ–ª—å–Ω—ã–π —ç—Ç–∞–∂",
      basement: "–ì–∞—Ä–∞–∂ –Ω–∞ 3-4 –∞–≤—Ç–æ–º–æ–±–∏–ª—è, –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è –∫–≤–∞—Ä—Ç–∏—Ä–∞ (–≥–æ—Å—Ç–∏–Ω–∞—è, –∫—É—Ö–Ω—è, —Å–ø–∞–ª—å–Ω—è, –≤–∞–Ω–Ω–∞—è), –∫–ª–∞–¥–æ–≤–∞—è",
      ground_floor: "–ü—Ä–æ—Å—Ç–æ—Ä–Ω–∞—è –ø—Ä–∏—Ö–æ–∂–∞—è, –≥–æ—Å—Ç–∏–Ω–∞—è-—Å—Ç–æ–ª–æ–≤–∞—è, –≥–æ—Å—Ç–∏–Ω–∞—è —Å –∫–∞–º–∏–Ω–æ–º, —Å–ø–∞–ª—å–Ω—è-–ª—é–∫—Å, —Ç—É–∞–ª–µ—Ç, –æ—Ç–¥–µ–ª—å–Ω–∞—è –∫—É—Ö–Ω—è, –≥–ª–∞–¥–∏–ª—å–Ω–∞—è",
      first_floor: "4 —Å–ø–∞–ª—å–Ω–∏: —Ç—Ä–∏ –¥–≤–æ–π–Ω—ã–µ —Å–ø–∞–ª—å–Ω–∏ (–¥–≤–µ –ª—é–∫—Å), –≥–ª–∞–≤–Ω–∞—è —Å–ø–∞–ª—å–Ω—è —Å –≥–∞—Ä–¥–µ—Ä–æ–±–Ω–æ–π –∏ –ø–æ–ª–Ω–æ–π –≤–∞–Ω–Ω–æ–π",
      second_floor: "–û—Ç–∫—Ä—ã—Ç–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ: —Å–ø–æ—Ä—Ç–∑–∞–ª, –∫–∏–Ω–æ–∑–∞–ª, –∫–∞–±–∏–Ω–µ—Ç, –≤–∞–Ω–Ω–∞—è, —Ç–µ—Ä—Ä–∞—Å–∞ —Å –æ—Ç–∫—Ä—ã—Ç—ã–º–∏ –≤–∏–¥–∞–º–∏"
    },
    legal_info: {
      license: "–î–µ–π—Å—Ç–≤—É—é—â–∞—è –ª–∏—Ü–µ–Ω–∑–∏—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞—Å–µ–ª–µ–Ω–∏—è",
      taxes: "–ù–∞–ª–æ–≥ –Ω–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å: –ø—Ä–∏–º–µ—Ä–Ω–æ 2.400‚Ç¨/–≥–æ–¥",
      community: "–ö–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã: 150‚Ç¨/–º–µ—Å—è—Ü",
      documentation: "–í—Å—è —é—Ä–∏–¥–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ –ø–æ—Ä—è–¥–∫–µ"
    }
  }
};

// Enhanced response patterns for better AI understanding
export const responsePatterns = {
  price: ['precio', 'price', 'preu', '—Ü–µ–Ω–∞', '—Å—Ç–æ–∏–º–æ—Å—Ç—å', 'cost', 'coste', 'vale', 'cuesta'],
  size: ['tama√±o', 'metros', 'size', 'mida', '—Ä–∞–∑–º–µ—Ä', '–ø–ª–æ—â–∞–¥—å', 'surface', 'superficie', 'm2'],
  bedrooms: ['dormitorios', 'habitaciones', 'bedrooms', 'habitacions', '—Å–ø–∞–ª—å–Ω–∏', '–∫–æ–º–Ω–∞—Ç', 'cuartos'],
  bathrooms: ['ba√±os', 'bathrooms', 'banys', '–≤–∞–Ω–Ω', '—Ç—É–∞–ª–µ—Ç', 'wc', 'aseos'],
  location: ['ubicaci√≥n', 'donde', 'location', 'where', 'ubicaci√≥', 'on', '–≥–¥–µ', '—Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ', 'sitio'],
  beach: ['playa', 'beach', 'platja', '–ø–ª—è–∂', '–º–æ—Ä–µ', 'mar', 'costa'],
  pool: ['piscina', 'pool', '–±–∞—Å—Å–µ–π–Ω', 'swimming'],
  parking: ['parking', 'garaje', 'garage', 'p√†rquing', '–ø–∞—Ä–∫–æ–≤–∫–∞', 'aparcamiento'],
  portaventura: ['portaventura', 'port aventura', '–ø–∞—Ä–∫ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏–π', 'parque', 'atracciones'],
  garden: ['jard√≠n', 'garden', 'jard√≠', '—Å–∞–¥', 'verde', 'plantas'],
  year: ['a√±o', 'cuando', 'construido', 'year', 'built', 'any', 'constru√Øt', '–≥–æ–¥', '–ø–æ—Å—Ç—Ä–æ–µ–Ω'],
  energy: ['energ√©tica', 'energy', 'energ√®tica', '—ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π', 'eficiencia', '–∫–ª–∞—Å—Å'],
  legal: ['legal', 'documentos', 'papers', 'documents', '–¥–æ–∫—É–º–µ–Ω—Ç—ã', '–ª–∏—Ü–µ–Ω–∑–∏—è', 'papers'],
  taxes: ['impuestos', 'taxes', 'impostos', '–Ω–∞–ª–æ–≥–∏', 'ibi', 'gastos'],
  technical: ['t√©cnico', 'technical', 't√®cnic', '—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π', 'construcci√≥n', 'materials'],
  investment: ['inversi√≥n', 'investment', 'inversi√≥', '–∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è', 'rentabilidad', 'negocio'],
  features: ['caracter√≠sticas', 'features', 'prestaciones', '—Ñ—É–Ω–∫—Ü–∏–∏', '—á—Ç–æ –µ—Å—Ç—å', '—á—Ç–æ –≤–∫–ª—é—á–µ–Ω–æ', 'amenities', 'facilities'],
  layout: ['distribuci√≥n', 'layout', 'distribuci√≥', '–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞', 'plantas', 'floors', 'plantes', '—ç—Ç–∞–∂–∏', 'como distribuida'],
  sauna: ['sauna', '—Å–∞—É–Ω–∞'],
  cinema: ['cine', 'cinema', '–∫–∏–Ω–æ', 'sala de cine', '–∫–∏–Ω–æ–∑–∞–ª'],
  gym: ['gimnasio', 'gym', 'gimn√†s', '—Å–ø–æ—Ä—Ç–∑–∞–ª', 'fitness']
};

// Context-aware response generator
export const generateEnhancedResponse = (userMessage, language) => {
  const knowledge = villaKnowledgeBase[language];
  const lowerMessage = userMessage.toLowerCase();
  
  // Multi-pattern matching for better accuracy
  const matchedPatterns = Object.entries(responsePatterns).filter(([key, patterns]) =>
    patterns.some(pattern => lowerMessage.includes(pattern))
  );

  if (matchedPatterns.length === 0) {
    return getFallbackResponse(language);
  }

  // Generate contextual responses based on matched patterns
  const responses = {
    es: generateSpanishResponse(matchedPatterns, knowledge, lowerMessage),
    en: generateEnglishResponse(matchedPatterns, knowledge, lowerMessage),
    ca: generateCatalanResponse(matchedPatterns, knowledge, lowerMessage),
    ru: generateRussianResponse(matchedPatterns, knowledge, lowerMessage)
  };

  return responses[language] || getFallbackResponse(language);
};

// Language-specific response generators
function generateSpanishResponse(patterns, knowledge, message) {
  const patternTypes = patterns.map(([type]) => type);
  
  if (patternTypes.includes('price')) {
    return `üí∞ El precio de esta exclusiva villa es de **${knowledge.property.price}**. Incluye ${knowledge.property.size} de superficie construida en una parcela de ${knowledge.property.plot_size}. La propiedad est√° construida en ${knowledge.property.year_built} con certificaci√≥n energ√©tica ${knowledge.property.energy_rating}.`;
  }
  
  if (patternTypes.includes('size')) {
    return `üìê La villa tiene **${knowledge.property.size}** de superficie construida en una parcela de **${knowledge.property.plot_size}**. Est√° perfectamente distribuida con ${knowledge.property.bedrooms} y ${knowledge.property.bathrooms}, adem√°s de amplias zonas comunes y terraza panor√°mica de 150m¬≤.`;
  }
  
  if (patternTypes.includes('bedrooms')) {
    return `üõèÔ∏è La propiedad cuenta con **${knowledge.property.bedrooms}** amplios y luminosos, cada uno con acceso a terraza o balc√≥n. Todas las habitaciones tienen suelo de parquet y ventanas de PVC con doble acristalamiento para m√°ximo confort.`;
  }
  
  if (patternTypes.includes('bathrooms')) {
    return `üöø La villa dispone de **${knowledge.property.bathrooms}** completamente equipados con acabados de alta calidad y sanitarios de √∫ltima generaci√≥n.`;
  }
  
  if (patternTypes.includes('location') || patternTypes.includes('beach')) {
    return `üèñÔ∏è Ubicada en **${knowledge.property.location}**, una zona premium de la Costa Dorada. **${knowledge.property.beach_distance}** y ${knowledge.property.portaventura}. La zona cuenta con excelente conectividad a Barcelona y Tarragona.`;
  }
  
  if (patternTypes.includes('pool') || patternTypes.includes('garden')) {
    return `üèä‚Äç‚ôÇÔ∏è S√≠, incluye una **piscina privada** con zona de relax en un precioso **jard√≠n mediterr√°neo de 400m¬≤**. El jard√≠n est√° dise√±ado con plantas aut√≥ctonas que requieren poco mantenimiento y proporcionan privacidad total.`;
  }
  
  if (patternTypes.includes('portaventura')) {
    return `üé¢ ¬°Perfecto para familias! **${knowledge.property.portaventura}**, uno de los parques tem√°ticos m√°s famosos de Europa. ¬°Los ni√±os lo van a adorar!`;
  }
  
  if (patternTypes.includes('parking')) {
    return `üöó S√≠, cuenta con **garaje para 3 veh√≠culos** con puertas autom√°ticas. Tambi√©n hay plazas de aparcamiento adicionales en la parcela.`;
  }
  
  if (patternTypes.includes('year')) {
    return `üèóÔ∏è La villa fue construida en **${knowledge.property.year_built}** con tecnolog√≠as y materiales de √∫ltima generaci√≥n. ¬°Construcci√≥n nueva con garant√≠a de calidad!`;
  }
  
  if (patternTypes.includes('energy')) {
    return `‚ö° ¬°Excelente noticia! La villa tiene **${knowledge.property.energy_rating}**, lo que significa gastos m√≠nimos en servicios y m√°ximo confort durante todo el a√±o.`;
  }
  
  if (patternTypes.includes('technical')) {
    return `üîß **Especificaciones t√©cnicas:** ${knowledge.technical_specs.construction}, ${knowledge.technical_specs.roof}, ${knowledge.technical_specs.windows}. Cuenta con ${knowledge.technical_specs.insulation} y ${knowledge.technical_specs.utilities}.`;
  }
  
  if (patternTypes.includes('legal') || patternTypes.includes('taxes')) {
    return `üìã **Informaci√≥n legal:** ${knowledge.legal_info.license}. ${knowledge.legal_info.taxes}, ${knowledge.legal_info.community}. ${knowledge.legal_info.documentation}.`;
  }
  
  if (patternTypes.includes('investment')) {
    return `üìà ¬°Excelente inversi√≥n! Cambrils es una ciudad tur√≠stica en crecimiento con alto potencial de revalorizaci√≥n. La rentabilidad por alquiler puede ser del 4-6% anual.`;
  }
  
  return getFallbackResponse('es');
}

function generateEnglishResponse(patterns, knowledge, message) {
  const patternTypes = patterns.map(([type]) => type);
  
  if (patternTypes.includes('price')) {
    return `üí∞ The price of this exclusive villa is **${knowledge.property.price}**. It includes ${knowledge.property.size} of built surface on a ${knowledge.property.plot_size}. The property was built in ${knowledge.property.year_built} with ${knowledge.property.energy_rating}.`;
  }
  
  if (patternTypes.includes('size')) {
    return `üìê The villa has **${knowledge.property.size}** of built surface on a **${knowledge.property.plot_size}**. It's perfectly distributed with ${knowledge.property.bedrooms} and ${knowledge.property.bathrooms}, plus spacious common areas and a 150m¬≤ panoramic terrace.`;
  }
  
  if (patternTypes.includes('bedrooms')) {
    return `üõèÔ∏è The property features **${knowledge.property.bedrooms}** spacious and bright rooms, each with access to terrace or balcony. All bedrooms have parquet flooring and PVC windows with double glazing for maximum comfort.`;
  }
  
  if (patternTypes.includes('bathrooms')) {
    return `üöø The villa has **${knowledge.property.bathrooms}** fully equipped with high-quality finishes and state-of-the-art fixtures.`;
  }
  
  if (patternTypes.includes('location') || patternTypes.includes('beach')) {
    return `üèñÔ∏è Located in **${knowledge.property.location}**, a premium area of Costa Dorada. **${knowledge.property.beach_distance}** and ${knowledge.property.portaventura}. The area has excellent connectivity to Barcelona and Tarragona.`;
  }
  
  if (patternTypes.includes('pool') || patternTypes.includes('garden')) {
    return `üèä‚Äç‚ôÇÔ∏è Yes, it includes a **private pool** with relaxation area in a beautiful **400m¬≤ Mediterranean garden**. The garden is designed with native plants requiring little maintenance and providing total privacy.`;
  }
  
  if (patternTypes.includes('portaventura')) {
    return `üé¢ Perfect for families! **${knowledge.property.portaventura}**, one of Europe's most famous theme parks. The kids will absolutely love it!`;
  }
  
  if (patternTypes.includes('parking')) {
    return `üöó Yes, it has a **3-car garage** with automatic doors. There are also additional parking spaces on the plot.`;
  }
  
  if (patternTypes.includes('year')) {
    return `üèóÔ∏è The villa was built in **${knowledge.property.year_built}** using cutting-edge technologies and materials. New construction with quality guarantee!`;
  }
  
  if (patternTypes.includes('energy')) {
    return `‚ö° Excellent news! The villa has **${knowledge.property.energy_rating}**, meaning minimal utility costs and maximum comfort year-round.`;
  }
  
  if (patternTypes.includes('technical')) {
    return `üîß **Technical specifications:** ${knowledge.technical_specs.construction}, ${knowledge.technical_specs.roof}, ${knowledge.technical_specs.windows}. Features ${knowledge.technical_specs.insulation} and ${knowledge.technical_specs.utilities}.`;
  }
  
  if (patternTypes.includes('legal') || patternTypes.includes('taxes')) {
    return `üìã **Legal information:** ${knowledge.legal_info.license}. ${knowledge.legal_info.taxes}, ${knowledge.legal_info.community}. ${knowledge.legal_info.documentation}.`;
  }
  
  if (patternTypes.includes('investment')) {
    return `üìà Excellent investment! Cambrils is a growing tourist city with high potential for property value appreciation. Rental yield can be 4-6% annually.`;
  }
  
  return getFallbackResponse('en');
}

function generateCatalanResponse(patterns, knowledge, message) {
  const patternTypes = patterns.map(([type]) => type);
  
  if (patternTypes.includes('price')) {
    return `üí∞ El preu d'aquesta vil¬∑la exclusiva √©s de **${knowledge.property.price}**. Inclou ${knowledge.property.size} de superf√≠cie constru√Øda en una parcel¬∑la de ${knowledge.property.plot_size}. La propietat est√† constru√Øda el ${knowledge.property.year_built} amb ${knowledge.property.energy_rating}.`;
  }
  
  if (patternTypes.includes('location') || patternTypes.includes('beach')) {
    return `üèñÔ∏è Ubicada a **${knowledge.property.location}**, una zona premium de la Costa Daurada. **${knowledge.property.beach_distance}** i ${knowledge.property.portaventura}. La zona compta amb excel¬∑lent connectivitat a Barcelona i Tarragona.`;
  }
  
  return getFallbackResponse('ca');
}

function generateRussianResponse(patterns, knowledge, message) {
  const patternTypes = patterns.map(([type]) => type);
  
  if (patternTypes.includes('price')) {
    return `üí∞ –¶–µ–Ω–∞ —ç—Ç–æ–π —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω–æ–π –≤–∏–ª–ª—ã —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç **${knowledge.property.price}**. –í–∫–ª—é—á–∞–µ—Ç ${knowledge.property.size} –∑–∞—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π –ø–ª–æ—â–∞–¥–∏ –Ω–∞ —É—á–∞—Å—Ç–∫–µ ${knowledge.property.plot_size}. –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –≤ ${knowledge.property.year_built} –≥–æ–¥—É —Å ${knowledge.property.energy_rating}.`;
  }
  
  if (patternTypes.includes('size')) {
    return `üìê –í–∏–ª–ª–∞ –∏–º–µ–µ—Ç **${knowledge.property.size}** –∑–∞—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π –ø–ª–æ—â–∞–¥–∏ –Ω–∞ —É—á–∞—Å—Ç–∫–µ **${knowledge.property.plot_size}**. –ò–¥–µ–∞–ª—å–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ —Å ${knowledge.property.bedrooms} –∏ ${knowledge.property.bathrooms}, –ø–ª—é—Å –ø—Ä–æ—Å—Ç–æ—Ä–Ω—ã–µ –æ–±—â–∏–µ –∑–æ–Ω—ã –∏ –ø–∞–Ω–æ—Ä–∞–º–Ω–∞—è —Ç–µ—Ä—Ä–∞—Å–∞ 150–º¬≤.`;
  }
  
  if (patternTypes.includes('bedrooms')) {
    return `üõèÔ∏è –í –≤–∏–ª–ª–µ **${knowledge.property.bedrooms}** –ø—Ä–æ—Å—Ç–æ—Ä–Ω—ã—Ö –∏ —Å–≤–µ—Ç–ª—ã—Ö, –∫–∞–∂–¥–∞—è —Å –≤—ã—Ö–æ–¥–æ–º –Ω–∞ —Ç–µ—Ä—Ä–∞—Å—É –∏–ª–∏ –±–∞–ª–∫–æ–Ω. –í–æ –≤—Å–µ—Ö —Å–ø–∞–ª—å–Ω—è—Ö –ø–∞—Ä–∫–µ—Ç–Ω—ã–µ –ø–æ–ª—ã –∏ –ü–í–• –æ–∫–Ω–∞ —Å –¥–≤–æ–π–Ω—ã–º –æ—Å—Ç–µ–∫–ª–µ–Ω–∏–µ–º –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–º—Ñ–æ—Ä—Ç–∞.`;
  }
  
  if (patternTypes.includes('bathrooms')) {
    return `üöø –í —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ **${knowledge.property.bathrooms}** –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–Ω—ã—Ö –≤—ã—Å–æ–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –æ—Ç–¥–µ–ª–∫–æ–π –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π —Å–∞–Ω—Ç–µ—Ö–Ω–∏–∫–æ–π.`;
  }
  
  if (patternTypes.includes('location') || patternTypes.includes('beach')) {
    return `üèñÔ∏è –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∞ –≤ **${knowledge.property.location}**, –ø—Ä–µ–º–∏–∞–ª—å–Ω–æ–º —Ä–∞–π–æ–Ω–µ –ö–æ—Å—Ç–∞-–î–æ—Ä–∞–¥–∞. **${knowledge.property.beach_distance}** –∏ ${knowledge.property.portaventura}. –í —Ä–∞–π–æ–Ω–µ –æ—Ç–ª–∏—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ë–∞—Ä—Å–µ–ª–æ–Ω–æ–π –∏ –¢–∞—Ä—Ä–∞–≥–æ–Ω–æ–π.`;
  }
  
  if (patternTypes.includes('pool') || patternTypes.includes('garden')) {
    return `üèä‚Äç‚ôÇÔ∏è –î–∞, –≤–∫–ª—é—á–∞–µ—Ç **—á–∞—Å—Ç–Ω—ã–π –±–∞—Å—Å–µ–π–Ω** —Å –∑–æ–Ω–æ–π –æ—Ç–¥—ã—Ö–∞ –≤ –∫—Ä–∞—Å–∏–≤–æ–º **—Å—Ä–µ–¥–∏–∑–µ–º–Ω–æ–º–æ—Ä—Å–∫–æ–º —Å–∞–¥—É 400–º¬≤**. –°–∞–¥ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω —Å –º–µ—Å—Ç–Ω—ã–º–∏ —Ä–∞—Å—Ç–µ–Ω–∏—è–º–∏, —Ç—Ä–µ–±—É—é—â–∏–º–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ —É—Ö–æ–¥–∞ –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–º–∏ –ø–æ–ª–Ω—É—é –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å.`;
  }
  
  if (patternTypes.includes('portaventura')) {
    return `üé¢ –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è —Å–µ–º–µ–π! **${knowledge.property.portaventura}**, –æ–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ä–∫–æ–≤ –ï–≤—Ä–æ–ø—ã. –î–µ—Ç–∏ –±—É–¥—É—Ç –≤ –≤–æ—Å—Ç–æ—Ä–≥–µ!`;
  }
  
  if (patternTypes.includes('parking')) {
    return `üöó –î–∞, –µ—Å—Ç—å **–≥–∞—Ä–∞–∂ –Ω–∞ 3 –∞–≤—Ç–æ–º–æ–±–∏–ª—è** —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ –≤–æ—Ä–æ—Ç–∞–º–∏. –¢–∞–∫–∂–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∫–æ–≤–æ—á–Ω—ã–µ –º–µ—Å—Ç–∞ –Ω–∞ —É—á–∞—Å—Ç–∫–µ.`;
  }
  
  if (patternTypes.includes('year')) {
    return `üèóÔ∏è –í–∏–ª–ª–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –≤ **${knowledge.property.year_built} –≥–æ–¥—É** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤. –ù–æ–≤–æ–µ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ —Å –≥–∞—Ä–∞–Ω—Ç–∏–µ–π –∫–∞—á–µ—Å—Ç–≤–∞!`;
  }
  
  if (patternTypes.includes('energy')) {
    return `‚ö° –û—Ç–ª–∏—á–Ω–∞—è –Ω–æ–≤–æ—Å—Ç—å! –í–∏–ª–ª–∞ –∏–º–µ–µ—Ç **${knowledge.property.energy_rating}**, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ –∫–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏ –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∫–æ–º—Ñ–æ—Ä—Ç –∫—Ä—É–≥–ª—ã–π –≥–æ–¥.`;
  }
  
  if (patternTypes.includes('technical')) {
    return `üîß **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:** ${knowledge.technical_specs.construction}, ${knowledge.technical_specs.roof}, ${knowledge.technical_specs.windows}. ${knowledge.technical_specs.insulation} –∏ ${knowledge.technical_specs.utilities}.`;
  }
  
  if (patternTypes.includes('legal') || patternTypes.includes('taxes')) {
    return `üìã **–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:** ${knowledge.legal_info.license}. ${knowledge.legal_info.taxes}, ${knowledge.legal_info.community}. ${knowledge.legal_info.documentation}.`;
  }
  
  if (patternTypes.includes('investment')) {
    return `üìà –û—Ç–ª–∏—á–Ω–∞—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è! –ö–∞–º–±—Ä–∏–ª—Å - —Ä–∞—Å—Ç—É—â–∏–π –∫—É—Ä–æ—Ä—Ç–Ω—ã–π –≥–æ—Ä–æ–¥ —Å –≤—ã—Å–æ–∫–∏–º –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–æ–º —Ä–æ—Å—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏. –î–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –æ—Ç –∞—Ä–µ–Ω–¥—ã –º–æ–∂–µ—Ç —Å–æ—Å—Ç–∞–≤–ª—è—Ç—å 4-6% –≤ –≥–æ–¥.`;
  }
  
  if (patternTypes.includes('features')) {
    const features = knowledge.property.features.slice(0, 6).join(', ');
    return `‚ú® **–û—Å–Ω–æ–≤–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:** ${features}. –≠—Ç–∞ –≤–∏–ª–ª–∞ —Å–æ—á–µ—Ç–∞–µ—Ç —Ä–æ—Å–∫–æ—à—å, –∫–æ–º—Ñ–æ—Ä—Ç –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –≤ –ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –º–µ—Å—Ç–µ –ö–æ—Å—Ç–∞-–î–æ—Ä–∞–¥–∞.`;
  }
  
  if (patternTypes.includes('layout')) {
    return `üèóÔ∏è **–ü–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ –æ—Å–æ–±–Ω—è–∫–∞:** ${knowledge.technical_specs.layout}.\n\n**–¶–æ–∫–æ–ª—å–Ω—ã–π —ç—Ç–∞–∂:** ${knowledge.technical_specs.basement}\n**–ü–µ—Ä–≤—ã–π —ç—Ç–∞–∂:** ${knowledge.technical_specs.ground_floor}\n**–í—Ç–æ—Ä–æ–π —ç—Ç–∞–∂:** ${knowledge.technical_specs.first_floor}\n**–¢—Ä–µ—Ç–∏–π —ç—Ç–∞–∂:** ${knowledge.technical_specs.second_floor}`;
  }
  
  if (patternTypes.includes('sauna')) {
    return `üßñ‚Äç‚ôÄÔ∏è –î–∞! –í –æ—Å–æ–±–Ω—è–∫–µ –µ—Å—Ç—å **–¥–µ—Ä–µ–≤—è–Ω–Ω–∞—è —Å–∞—É–Ω–∞** - –∏–¥–µ–∞–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ –¥–ª—è —Ä–µ–ª–∞–∫—Å–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –¥–æ–ª–≥–æ–≥–æ –¥–Ω—è. –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∞ –≤ —Å–∞–¥–æ–≤–æ–π –∑–æ–Ω–µ —Ä—è–¥–æ–º —Å –±–∞—Å—Å–µ–π–Ω–æ–º.`;
  }
  
  if (patternTypes.includes('cinema')) {
    return `üé¨ –í–µ–ª–∏–∫–æ–ª–µ–ø–Ω–æ! –ù–∞ —Ç—Ä–µ—Ç—å–µ–º —ç—Ç–∞–∂–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω **–∫–∏–Ω–æ–∑–∞–ª** –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è —Å–µ–º–µ–π–Ω—ã—Ö –≤–µ—á–µ—Ä–æ–≤ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ñ–∏–ª—å–º–æ–≤ –≤ –¥–æ–º–∞—à–Ω–µ–π –∞—Ç–º–æ—Å—Ñ–µ—Ä–µ.`;
  }
  
  if (patternTypes.includes('gym')) {
    return `üèãÔ∏è‚Äç‚ôÇÔ∏è –û—Ç–ª–∏—á–Ω–æ! –ù–∞ —Ç—Ä–µ—Ç—å–µ–º —ç—Ç–∞–∂–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è **—Å–ø–æ—Ä—Ç–∑–∞–ª** –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ —Ñ–æ—Ä–º—É –Ω–µ –≤—ã—Ö–æ–¥—è –∏–∑ –¥–æ–º–∞!`;
  }
  
  return getFallbackResponse('ru');
}

function getFallbackResponse(language) {
  const fallbacks = {
    es: `Gracias por tu consulta sobre esta magn√≠fica villa. Para informaci√≥n m√°s detallada y personalizada, no dudes en contactarnos:\n\nüì± **WhatsApp:** +34 677 743 005\nüìß **Email:** info@inmolarisa.com\n\n¬°Estaremos encantados de resolver todas tus dudas y organizar una visita!`,
    en: `Thank you for your inquiry about this magnificent villa. For more detailed and personalized information, please don't hesitate to contact us:\n\nüì± **WhatsApp:** +34 677 743 005\nüìß **Email:** info@inmolarisa.com\n\nWe'll be happy to answer all your questions and arrange a viewing!`,
    ca: `Gr√†cies per la teva consulta sobre aquesta magn√≠fica vil¬∑la. Per a informaci√≥ m√©s detallada i personalitzada, no dubtis a contactar-nos:\n\nüì± **WhatsApp:** +34 677 743 005\nüìß **Email:** info@inmolarisa.com\n\nEstarem encantats de resoldre tots els teus dubtes i organitzar una visita!`,
    ru: `–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à –∑–∞–ø—Ä–æ—Å –æ–± —ç—Ç–æ–π –≤–µ–ª–∏–∫–æ–ª–µ–ø–Ω–æ–π –≤–∏–ª–ª–µ. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏:\n\nüì± **WhatsApp:** +34 677 743 005\nüìß **Email:** info@inmolarisa.com\n\n–ú—ã –±—É–¥–µ–º —Ä–∞–¥—ã –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤—Å–µ –≤–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã –∏ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä!`
  };
  
  return fallbacks[language] || fallbacks.es;
}
