// Enhanced Chatbot Knowledge Base with PDF data integration
export const villaKnowledgeBase = {
  es: {
    property: {
      price: "1.499.990 €",
      size: "805 m²",
      bedrooms: "6 dormitorios",
      bathrooms: "5 baños",
      features: [
        "Piscina privada con zona de relax",
        "Jardín mediterráneo de 400m²", 
        "Aire acondicionado central",
        "Calefacción por suelo radiante",
        "Garaje para 3 vehículos",
        "Terraza panorámica de 150m²",
        "Cocina americana totalmente equipada",
        "Sistema de domótica integrado",
        "Alarma y videovigilancia"
      ],
      location: "Jardins Vilafortuny, Cambrils",
      beach_distance: "1,4 km a la playa (5 minutos en coche, 20 minutos andando)",
      portaventura: "15 minutos en coche a PortAventura",
      year_built: "2020",
      energy_rating: "Certificación energética A",
      orientation: "Sur-Este (máxima luminosidad)",
      plot_size: "1.200 m² de parcela"
    },
    advantages: [
      "Ubicación privilegiada en zona residencial tranquila",
      "Excelente conectividad con autopistas AP-7 y N-340",
      "Cerca de centros comerciales y restaurantes",
      "Zona verde con espacios naturales protegidos",
      "Transporte público directo a Barcelona y Tarragona",
      "Comunidad segura con vigilancia 24h",
      "Proximidad a colegios internacionales",
      "Campo de golf a 10 minutos"
    ],
    technical_specs: {
      construction: "Estructura de hormigón armado",
      roof: "Cubierta plana transitable",
      windows: "Ventanas de PVC con doble acristalamiento",
      flooring: "Gres porcelánico y parquet en dormitorios",
      insulation: "Aislamiento térmico y acústico superior",
      utilities: "Instalaciones de fontanería y electricidad certificadas"
    },
    legal_info: {
      license: "Licencia de primera ocupación vigente",
      taxes: "IBI: 2.400€/año aproximadamente",
      community: "Gastos de comunidad: 150€/mes",
      documentation: "Toda la documentación legal en regla"
    }
  },
  en: {
    property: {
      price: "€1,499,990",
      size: "805 m²",
      bedrooms: "6 bedrooms",
      bathrooms: "5 bathrooms",
      features: [
        "Private pool with relaxation area",
        "400m² Mediterranean garden",
        "Central air conditioning",
        "Underfloor heating",
        "3-car garage",
        "150m² panoramic terrace",
        "Fully equipped open-plan kitchen",
        "Integrated home automation system",
        "Security alarm and video surveillance"
      ],
      location: "Jardins Vilafortuny, Cambrils",
      beach_distance: "1.4 km to beach (5 minutes by car, 20 minutes walking)",
      portaventura: "15 minutes by car to PortAventura",
      year_built: "2020",
      energy_rating: "Energy rating A",
      orientation: "South-East (maximum brightness)",
      plot_size: "1,200 m² plot"
    },
    advantages: [
      "Privileged location in quiet residential area",
      "Excellent highway connectivity AP-7 and N-340",
      "Close to shopping centers and restaurants",
      "Green areas with protected natural spaces",
      "Direct public transport to Barcelona and Tarragona",
      "Safe community with 24h security",
      "Proximity to international schools",
      "Golf course 10 minutes away"
    ],
    technical_specs: {
      construction: "Reinforced concrete structure",
      roof: "Accessible flat roof",
      windows: "PVC windows with double glazing",
      flooring: "Porcelain stoneware and parquet in bedrooms",
      insulation: "Superior thermal and acoustic insulation",
      utilities: "Certified plumbing and electrical installations"
    },
    legal_info: {
      license: "Valid first occupancy license",
      taxes: "Property tax: approximately €2,400/year",
      community: "Community fees: €150/month",
      documentation: "All legal documentation in order"
    }
  },
  ca: {
    property: {
      price: "1.499.990 €",
      size: "805 m²",
      bedrooms: "6 habitacions",
      bathrooms: "5 banys",
      features: [
        "Piscina privada amb zona de relax",
        "Jardí mediterrani de 400m²",
        "Aire condicionat central",
        "Calefacció per terra radiant",
        "Garatge per a 3 vehicles",
        "Terrassa panoràmica de 150m²",
        "Cuina americana completament equipada",
        "Sistema de domòtica integrat",
        "Alarma i videovigilància"
      ],
      location: "Jardins Vilafortuny, Cambrils",
      beach_distance: "1,4 km a la platja (5 minuts amb cotxe, 20 minuts caminant)",
      portaventura: "15 minuts amb cotxe a PortAventura",
      year_built: "2020",
      energy_rating: "Certificació energètica A",
      orientation: "Sud-Est (màxima lluminositat)",
      plot_size: "1.200 m² de parcel·la"
    },
    advantages: [
      "Ubicació privilegiada en zona residencial tranquil·la",
      "Excel·lent connectivitat amb autopistes AP-7 i N-340",
      "A prop de centres comercials i restaurants",
      "Zona verda amb espais naturals protegits",
      "Transport públic directe a Barcelona i Tarragona",
      "Comunitat segura amb vigilància 24h",
      "Proximitat a col·legis internacionals",
      "Camp de golf a 10 minuts"
    ],
    technical_specs: {
      construction: "Estructura de formigó armat",
      roof: "Coberta plana transitable",
      windows: "Finestres de PVC amb doble vidre",
      flooring: "Gres porcellànic i parquet en dormitoris",
      insulation: "Aïllament tèrmic i acústic superior",
      utilities: "Instal·lacions de fontaneria i electricitat certificades"
    },
    legal_info: {
      license: "Llicència de primera ocupació vigent",
      taxes: "IBI: 2.400€/any aproximadament",
      community: "Despeses de comunitat: 150€/mes",
      documentation: "Tota la documentació legal en regla"
    }
  },
  ru: {
    property: {
      price: "1.499.990 €",
      size: "805 м²",
      bedrooms: "6 спален",
      bathrooms: "5 ванных комнат",
      features: [
        "Частный бассейн с зоной отдыха",
        "Средиземноморский сад 400м²",
        "Центральное кондиционирование",
        "Теплый пол",
        "Гараж на 3 автомобиля",
        "Панорамная терраса 150м²",
        "Полностью оборудованная кухня-студия",
        "Интегрированная система умный дом",
        "Сигнализация и видеонаблюдение"
      ],
      location: "Жардинс Вилафортуни, Камбрилс",
      beach_distance: "1,4 км до пляжа (5 минут на машине, 20 минут пешком)",
      portaventura: "15 минут на машине до Порт-Авентуры",
      year_built: "2020",
      energy_rating: "Энергетический класс A",
      orientation: "Юго-Восток (максимальная освещенность)",
      plot_size: "Участок 1.200 м²"
    },
    advantages: [
      "Привилегированное расположение в тихом жилом районе",
      "Отличная связь с автомагистралями AP-7 и N-340",
      "Рядом торговые центры и рестораны",
      "Зеленая зона с охраняемыми природными пространствами",
      "Прямое сообщение с Барселоной и Таррагоной",
      "Безопасное сообщество с охраной 24ч",
      "Близость к международным школам",
      "Поле для гольфа в 10 минутах"
    ],
    technical_specs: {
      construction: "Железобетонная конструкция",
      roof: "Плоская эксплуатируемая кровля",
      windows: "ПВХ окна с двойным остеклением",
      flooring: "Керамогранит и паркет в спальнях",
      insulation: "Превосходная тепло- и звукоизоляция",
      utilities: "Сертифицированные водопровод и электричество"
    },
    legal_info: {
      license: "Действующая лицензия первого заселения",
      taxes: "Налог на недвижимость: примерно 2.400€/год",
      community: "Коммунальные расходы: 150€/месяц",
      documentation: "Вся юридическая документация в порядке"
    }
  }
};

// Enhanced response patterns for better AI understanding
export const responsePatterns = {
  price: ['precio', 'price', 'preu', 'цена', 'стоимость', 'cost', 'coste', 'vale', 'cuesta'],
  size: ['tamaño', 'metros', 'size', 'mida', 'размер', 'площадь', 'surface', 'superficie', 'm2'],
  bedrooms: ['dormitorios', 'habitaciones', 'bedrooms', 'habitacions', 'спальни', 'комнат', 'cuartos'],
  bathrooms: ['baños', 'bathrooms', 'banys', 'ванн', 'туалет', 'wc', 'aseos'],
  location: ['ubicación', 'donde', 'location', 'where', 'ubicació', 'on', 'где', 'расположение', 'sitio'],
  beach: ['playa', 'beach', 'platja', 'пляж', 'море', 'mar', 'costa'],
  pool: ['piscina', 'pool', 'бассейн', 'swimming'],
  parking: ['parking', 'garaje', 'garage', 'pàrquing', 'парковка', 'aparcamiento'],
  portaventura: ['portaventura', 'port aventura', 'парк развлечений', 'parque', 'atracciones'],
  garden: ['jardín', 'garden', 'jardí', 'сад', 'verde', 'plantas'],
  year: ['año', 'cuando', 'construido', 'year', 'built', 'any', 'construït', 'год', 'построен'],
  energy: ['energética', 'energy', 'energètica', 'энергетический', 'eficiencia', 'класс'],
  legal: ['legal', 'documentos', 'papers', 'documents', 'документы', 'лицензия', 'papers'],
  taxes: ['impuestos', 'taxes', 'impostos', 'налоги', 'ibi', 'gastos'],
  technical: ['técnico', 'technical', 'tècnic', 'технический', 'construcción', 'materials'],
  investment: ['inversión', 'investment', 'inversió', 'инвестиция', 'rentabilidad', 'negocio']
};

// Context-aware response generator
export const generateEnhancedResponse = (userMessage, language) => {
  const knowledge = villaKnowledgeBase[language];
  const lowerMessage = userMessage.toLowerCase();
  
  // Multi-pattern matching for better accuracy
  const matchedPatterns = Object.entries(responsePatterns).filter(([key, patterns]) =>
    patterns.some(pattern => lowerMessage.includes(pattern))
  );

  if (matchedPatterns.length === 0) {
    return getFallbackResponse(language);
  }

  // Generate contextual responses based on matched patterns
  const responses = {
    es: generateSpanishResponse(matchedPatterns, knowledge, lowerMessage),
    en: generateEnglishResponse(matchedPatterns, knowledge, lowerMessage),
    ca: generateCatalanResponse(matchedPatterns, knowledge, lowerMessage),
    ru: generateRussianResponse(matchedPatterns, knowledge, lowerMessage)
  };

  return responses[language] || getFallbackResponse(language);
};

// Language-specific response generators
function generateSpanishResponse(patterns, knowledge, message) {
  const patternTypes = patterns.map(([type]) => type);
  
  if (patternTypes.includes('price')) {
    return `💰 El precio de esta exclusiva villa es de **${knowledge.property.price}**. Incluye ${knowledge.property.size} de superficie construida en una parcela de ${knowledge.property.plot_size}. La propiedad está construida en ${knowledge.property.year_built} con certificación energética ${knowledge.property.energy_rating}.`;
  }
  
  if (patternTypes.includes('size')) {
    return `📐 La villa tiene **${knowledge.property.size}** de superficie construida en una parcela de **${knowledge.property.plot_size}**. Está perfectamente distribuida con ${knowledge.property.bedrooms} y ${knowledge.property.bathrooms}, además de amplias zonas comunes y terraza panorámica de 150m².`;
  }
  
  if (patternTypes.includes('bedrooms')) {
    return `🛏️ La propiedad cuenta con **${knowledge.property.bedrooms}** amplios y luminosos, cada uno con acceso a terraza o balcón. Todas las habitaciones tienen suelo de parquet y ventanas de PVC con doble acristalamiento para máximo confort.`;
  }
  
  if (patternTypes.includes('location') || patternTypes.includes('beach')) {
    return `🏖️ Ubicada en **${knowledge.property.location}**, una zona premium de la Costa Dorada. **${knowledge.property.beach_distance}** y ${knowledge.property.portaventura}. La zona cuenta con excelente conectividad a Barcelona y Tarragona.`;
  }
  
  if (patternTypes.includes('pool') || patternTypes.includes('garden')) {
    return `🏊‍♂️ Sí, incluye una **piscina privada** con zona de relax en un precioso **jardín mediterráneo de 400m²**. El jardín está diseñado con plantas autóctonas que requieren poco mantenimiento y proporcionan privacidad total.`;
  }
  
  if (patternTypes.includes('technical')) {
    return `🔧 **Especificaciones técnicas:** ${knowledge.technical_specs.construction}, ${knowledge.technical_specs.roof}, ${knowledge.technical_specs.windows}. Cuenta con ${knowledge.technical_specs.insulation} y ${knowledge.technical_specs.utilities}.`;
  }
  
  if (patternTypes.includes('legal') || patternTypes.includes('taxes')) {
    return `📋 **Información legal:** ${knowledge.legal_info.license}. ${knowledge.legal_info.taxes}, ${knowledge.legal_info.community}. ${knowledge.legal_info.documentation}.`;
  }
  
  return getFallbackResponse('es');
}

function generateEnglishResponse(patterns, knowledge, message) {
  const patternTypes = patterns.map(([type]) => type);
  
  if (patternTypes.includes('price')) {
    return `💰 The price of this exclusive villa is **${knowledge.property.price}**. It includes ${knowledge.property.size} of built surface on a ${knowledge.property.plot_size}. The property was built in ${knowledge.property.year_built} with ${knowledge.property.energy_rating}.`;
  }
  
  if (patternTypes.includes('size')) {
    return `📐 The villa has **${knowledge.property.size}** of built surface on a **${knowledge.property.plot_size}**. It's perfectly distributed with ${knowledge.property.bedrooms} and ${knowledge.property.bathrooms}, plus spacious common areas and a 150m² panoramic terrace.`;
  }
  
  if (patternTypes.includes('bedrooms')) {
    return `🛏️ The property features **${knowledge.property.bedrooms}** spacious and bright rooms, each with access to terrace or balcony. All bedrooms have parquet flooring and PVC windows with double glazing for maximum comfort.`;
  }
  
  if (patternTypes.includes('location') || patternTypes.includes('beach')) {
    return `🏖️ Located in **${knowledge.property.location}**, a premium area of Costa Dorada. **${knowledge.property.beach_distance}** and ${knowledge.property.portaventura}. The area has excellent connectivity to Barcelona and Tarragona.`;
  }
  
  if (patternTypes.includes('pool') || patternTypes.includes('garden')) {
    return `🏊‍♂️ Yes, it includes a **private pool** with relaxation area in a beautiful **400m² Mediterranean garden**. The garden is designed with native plants requiring little maintenance and providing total privacy.`;
  }
  
  return getFallbackResponse('en');
}

function generateCatalanResponse(patterns, knowledge, message) {
  const patternTypes = patterns.map(([type]) => type);
  
  if (patternTypes.includes('price')) {
    return `💰 El preu d'aquesta vil·la exclusiva és de **${knowledge.property.price}**. Inclou ${knowledge.property.size} de superfície construïda en una parcel·la de ${knowledge.property.plot_size}. La propietat està construïda el ${knowledge.property.year_built} amb ${knowledge.property.energy_rating}.`;
  }
  
  if (patternTypes.includes('location') || patternTypes.includes('beach')) {
    return `🏖️ Ubicada a **${knowledge.property.location}**, una zona premium de la Costa Daurada. **${knowledge.property.beach_distance}** i ${knowledge.property.portaventura}. La zona compta amb excel·lent connectivitat a Barcelona i Tarragona.`;
  }
  
  return getFallbackResponse('ca');
}

function generateRussianResponse(patterns, knowledge, message) {
  const patternTypes = patterns.map(([type]) => type);
  
  if (patternTypes.includes('price')) {
    return `💰 Цена этой эксклюзивной виллы составляет **${knowledge.property.price}**. Включает ${knowledge.property.size} застроенной площади на участке ${knowledge.property.plot_size}. Недвижимость построена в ${knowledge.property.year_built} году с ${knowledge.property.energy_rating}.`;
  }
  
  if (patternTypes.includes('location') || patternTypes.includes('beach')) {
    return `🏖️ Расположена в **${knowledge.property.location}**, премиальном районе Коста-Дорада. **${knowledge.property.beach_distance}** и ${knowledge.property.portaventura}. В районе отличное сообщение с Барселоной и Таррагоной.`;
  }
  
  return getFallbackResponse('ru');
}

function getFallbackResponse(language) {
  const fallbacks = {
    es: `Gracias por tu consulta sobre esta magnífica villa. Para información más detallada y personalizada, no dudes en contactarnos:\n\n📱 **WhatsApp:** +34 677 743 005\n📧 **Email:** info@inmolarisa.com\n\n¡Estaremos encantados de resolver todas tus dudas y organizar una visita!`,
    en: `Thank you for your inquiry about this magnificent villa. For more detailed and personalized information, please don't hesitate to contact us:\n\n📱 **WhatsApp:** +34 677 743 005\n📧 **Email:** info@inmolarisa.com\n\nWe'll be happy to answer all your questions and arrange a viewing!`,
    ca: `Gràcies per la teva consulta sobre aquesta magnífica vil·la. Per a informació més detallada i personalitzada, no dubtis a contactar-nos:\n\n📱 **WhatsApp:** +34 677 743 005\n📧 **Email:** info@inmolarisa.com\n\nEstarem encantats de resoldre tots els teus dubtes i organitzar una visita!`,
    ru: `Спасибо за ваш запрос об этой великолепной вилле. Для получения более подробной и персонализированной информации, пожалуйста, свяжитесь с нами:\n\n📱 **WhatsApp:** +34 677 743 005\n📧 **Email:** info@inmolarisa.com\n\nМы будем рады ответить на все ваши вопросы и организовать просмотр!`
  };
  
  return fallbacks[language] || fallbacks.es;
}
